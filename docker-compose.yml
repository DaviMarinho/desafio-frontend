services:
  # ==========================================
  # Frontend React (Desenvolvimento) - DEFAULT
  # Inclui json-server integrado
  # Use: docker compose up
  # ==========================================
  frontend-dev:
    build:
      context: .
      dockerfile: Dockerfile
      target: development
    container_name: prova-frontend-dev
    ports:
      - "3000:3000"
      - "3003:3003"
    volumes:
      - ./src:/app/src
      - ./public:/app/public
      - ./db.json:/app/db.json
    environment:
      - REACT_APP_API_URL=http://localhost:3003
      - REACT_APP_VIACEP_URL=https://viacep.com.br/ws
      - CHOKIDAR_USEPOLLING=true  # Para hot reload no Docker
    networks:
      - app-network
    restart: unless-stopped

  # ==========================================
  # Frontend React (Produção com Nginx)
  # Use: docker compose --profile production up
  # ==========================================
  frontend-prod:
    build:
      context: .
      dockerfile: Dockerfile
      target: production
    container_name: prova-frontend-prod
    ports:
      - "3000:80"
    networks:
      - app-network
    restart: unless-stopped
    profiles:
      - production

  # ==========================================
  # JSON Server (Mock API) - Standalone
  # Use: docker compose --profile standalone up
  # ==========================================
  json-server:
    image: node:18-alpine
    container_name: prova-json-server
    working_dir: /app
    ports:
      - "3003:3003"
    volumes:
      - ./db.json:/app/db.json
    command: npx json-server --watch db.json --port 3003 --host 0.0.0.0
    networks:
      - app-network
    restart: unless-stopped
    profiles:
      - standalone

networks:
  app-network:
    driver: bridge
